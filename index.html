<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Criminopat√≠a ¬∑ Caso Final</title>

<style>
  body{
    margin:0;
    background:#0e0e12;
    color:#f2f2f2;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .wrap{ max-width:720px; margin:auto; padding:20px; }
  .card{
    background:#17171c;
    border:1px solid #2b2b36;
    border-radius:18px;
    padding:18px;
    box-shadow:0 20px 40px rgba(0,0,0,.35);
  }
  h1{ font-size:22px; margin:0 0 6px; }
  p{ color:#cfcfda; }
  .timer{ font-weight:bold; color:#ffd36e; }
  .q{
    margin-top:16px;
    padding:14px;
    background:#121217;
    border-radius:14px;
    border:1px dashed #3a3a46;
  }
  button{
    width:100%;
    padding:12px;
    margin-top:8px;
    border-radius:12px;
    border:1px solid #333343;
    background:#1f1f28;
    color:#f2f2f2;
    font-size:15px;
    cursor:pointer;
  }
  button:hover{ background:#2a2a36; }
  button:disabled{ opacity:.5; cursor:not-allowed; }
  .ok{ color:#7CFFB2; }
  .bad{ color:#ff8b8b; }
  .lock{ color:#ff5252; font-weight:bold; }
  img{
    width:100%;
    border-radius:16px;
    margin-top:20px;
    display:none;
    border:1px solid #2b2b36;
  }
  .download{
    display:none;
    margin-top:10px;
    background:#2a7cff;
    text-align:center;
    padding:12px;
    border-radius:12px;
    border:1px solid #333343;
    color:#fff;
    text-decoration:none;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <h1>Criminopat√≠a ¬∑ Acceso restringido</h1>
    <p id="status">Tiempo restante: <span class="timer" id="timer"></span> segundos</p>

    <div id="quiz"></div>
    <p id="msg"></p>

    <!-- DECISI√ìN tras 10 -->
    <div id="decision" style="display:none;">
      <div class="q">
        <h2>üóÇÔ∏è Expediente resuelto‚Ä¶ ¬øo sigues investigando?</h2>
        <button onclick="darPremio()">üéÅ Obtener el premio</button>
        <button onclick="continuar()">üîç Seguir investigando (10 preguntas m√°s)</button>
      </div>
    </div>

    <img id="reward" src="regalo.png" alt="Evidencia final">
    <a id="downloadBtn" class="download" download="evidencia_final.png" href="regalo.png">‚¨áÔ∏è Descargar evidencia</a>

  </div>
</div>

<audio id="soundOk" src="acierto.mp3" preload="auto"></audio>
<audio id="soundFail" src="fallo.mp3" preload="auto"></audio>

<script>
/* ================= CONFIG ================= */
const TIEMPO_POR_PREGUNTA = 15;
const MAX_FALLOS = 3;
const STORAGE_KEY = "criminopatia_bloqueado";

/* ================= PREGUNTAS =================
   Nota: Son preguntas tipo quiz (cultura general true crime). */
const BLOQUE1 = [
  {t:"1Ô∏è‚É£ Caso Alc√†sser", q:"¬øCu√°ntas chicas desaparecieron?", o:["Tres","Dos","Cuatro"], c:"Tres"},
  {t:"2Ô∏è‚É£ Marta del Castillo", q:"¬øQu√© sigue siendo un misterio central?", o:["El paradero del cuerpo","La identidad de la v√≠ctima","El a√±o exacto"], c:"El paradero del cuerpo"},
  {t:"3Ô∏è‚É£ Asunta Basterra", q:"¬øQui√©nes fueron condenados?", o:["Sus padres","Un profesor","Un desconocido"], c:"Sus padres"},
  {t:"4Ô∏è‚É£ Roc√≠o Wanninkhof", q:"El error judicial inicial se debi√≥, en gran parte, a‚Ä¶", o:["Pruebas circunstanciales","Un v√≠deo","Una confesi√≥n"], c:"Pruebas circunstanciales"},
  {t:"5Ô∏è‚É£ Diana Quer", q:"¬øD√≥nde apareci√≥ el cuerpo?", o:["En un pozo","En el mar","En un bosque"], c:"En un pozo"},
  {t:"6Ô∏è‚É£ Marqueses de Urquijo", q:"Relaci√≥n del condenado m√°s medi√°tico con la familia", o:["Yerno","Vecino","Empleado"], c:"Yerno"},
  {t:"7Ô∏è‚É£ Caso Bret√≥n", q:"¬øQui√©nes fueron las v√≠ctimas?", o:["Sus hijos","Su pareja","Un familiar"], c:"Sus hijos"},
  {t:"8Ô∏è‚É£ Crimen de Patraix", q:"¬øD√≥nde ocurri√≥?", o:["En un garaje","En el campo","En una oficina"], c:"En un garaje"},
  {t:"9Ô∏è‚É£ Wanninkhof‚ÄìCarabantes", q:"¬øQu√© prueba fue clave para reabrir el caso?", o:["ADN","Testimonio","Confesi√≥n"], c:"ADN"},
  {t:"üîü Gabriel Cruz", q:"Apodo del ni√±o", o:["El Pesca√≠to","El Principito","El Ni√±o del Mar"], c:"El Pesca√≠to"}
];

const BLOQUE2 = [
  {t:"11Ô∏è‚É£ Crimen de los Galindos", q:"¬øD√≥nde ocurrieron los hechos?", o:["En una finca","En un hotel","En un puerto"], c:"En una finca"},
  {t:"12Ô∏è‚É£ Caso McCann", q:"¬øEn qu√© pa√≠s desapareci√≥ Madeleine?", o:["Portugal","Espa√±a","Francia"], c:"Portugal"},
  {t:"13Ô∏è‚É£ Asesino de la baraja", q:"¬øQu√© elemento se asociaba al caso?", o:["Naipes","Una rosa","Una moneda"], c:"Naipes"},
  {t:"14Ô∏è‚É£ Puerto Hurraco", q:"El suceso se asocia a una‚Ä¶", o:["Venganza familiar","Estafa financiera","Robo fallido"], c:"Venganza familiar"},
  {t:"15Ô∏è‚É£ Guardia Urbana", q:"Nombre de la principal condenada medi√°tica", o:["Rosa Peral","Dolores V√°zquez","Ana Julia"], c:"Rosa Peral"},
  {t:"16Ô∏è‚É£ Nagore Laffage", q:"Contexto del crimen (lugar/evento)", o:["San Ferm√≠n","Nochevieja","Carnaval"], c:"San Ferm√≠n"},
  {t:"17Ô∏è‚É£ Crimen de Fago", q:"¬øA qui√©n asesinaron?", o:["Al alcalde","A un juez","A un periodista"], c:"Al alcalde"},
  {t:"18Ô∏è‚É£ Caso del rol", q:"¬øCiudad asociada al caso?", o:["Madrid","Valencia","Sevilla"], c:"Madrid"},
  {t:"19Ô∏è‚É£ Wanninkhof (segunda v√≠ctima)", q:"¬øQui√©n fue la segunda v√≠ctima ligada al caso?", o:["Sonia Carabantes","Marta del Castillo","Asunta Basterra"], c:"Sonia Carabantes"},
  {t:"20Ô∏è‚É£ Caso Bret√≥n (detalle del encubrimiento)", q:"Se habl√≥ de intento de ocultaci√≥n mediante‚Ä¶", o:["Quemar los cuerpos","Arrojarlos al r√≠o","Enterrarlos en el monte"], c:"Quemar los cuerpos"}
];

/* ================= ESTADO ================= */
let preguntas = [...BLOQUE1];
let indice = 0;
let fallos = 0;
let tiempo = TIEMPO_POR_PREGUNTA;
let intervalo = null;

/* ================= BLOQUEO PERMANENTE ================= */
if (localStorage.getItem(STORAGE_KEY)) {
  document.getElementById("quiz").innerHTML = "<p class='lock'>üö´ Caso cerrado permanentemente.</p>";
  document.getElementById("timer").innerText = "‚Äî";
  throw new Error("Juego bloqueado");
}

/* ================= UTILS ================= */
function mezclar(a){ return a.sort(()=>Math.random()-0.5); }

function playOk(){
  const s = document.getElementById("soundOk");
  s.pause(); s.currentTime = 0;
  s.play().catch(()=>{ /* si el navegador bloquea autoplay, se desbloquea al tocar */ });
}
function playFail(){
  const s = document.getElementById("soundFail");
  s.pause(); s.currentTime = 0;
  s.play().catch(()=>{});
}

/* ================= TIMER ================= */
function iniciarTimer(){
  tiempo = TIEMPO_POR_PREGUNTA;
  document.getElementById("timer").innerText = tiempo;

  if (intervalo) clearInterval(intervalo);

  intervalo = setInterval(()=>{
    tiempo--;
    document.getElementById("timer").innerText = tiempo;

    if (tiempo <= 0){
      terminarJuego("‚è±Ô∏è Tiempo agotado. El expediente queda cerrado.");
    }
  }, 1000);
}

/* ================= RENDER ================= */
function render(){
  iniciarTimer();

  const p = preguntas[indice];
  const ops = mezclar([...p.o]);

  let html = `<div class="q"><h2>${p.t}<br>${p.q}</h2>`;
  ops.forEach(op=>{
    // usar JSON.stringify para evitar problemas con comillas
    html += `<button onclick="responder(${JSON.stringify(op)}, ${JSON.stringify(p.c)})">${op}</button>`;
  });
  html += `</div>`;

  document.getElementById("quiz").innerHTML = html;
}

/* ================= GAME LOGIC ================= */
function responder(sel, cor){
  if (intervalo) clearInterval(intervalo);

  if (sel === cor){
    playOk();
    document.getElementById("msg").innerHTML = "<span class='ok'>‚úîÔ∏è Correcto.</span>";
    indice++;

    // Si termin√≥ Bloque 1 (10 preguntas), ofrecer decisi√≥n
    if (indice === BLOQUE1.length && preguntas.length === BLOQUE1.length){
      document.getElementById("quiz").innerHTML = "";
      document.getElementById("decision").style.display = "block";
      document.getElementById("timer").innerText = "‚Äî";
      return;
    }

    // Si termin√≥ todas las preguntas del set actual
    if (indice >= preguntas.length){
      ganar();
      return;
    }

    setTimeout(render, 600);
  } else {
    fallos++;
    playFail();

    document.getElementById("msg").innerHTML =
      `<span class="bad">‚ùå Incorrecto. Fallos: ${fallos}/${MAX_FALLOS}</span>`;

    if (fallos >= MAX_FALLOS){
      terminarJuego("Has fallado demasiadas veces. El expediente se archiva.");
      return;
    }

    setTimeout(render, 600);
  }
}

function continuar(){
  // Cambiamos el set de preguntas a 20 total
  preguntas = [...BLOQUE1, ...BLOQUE2];
  document.getElementById("decision").style.display = "none";
  document.getElementById("msg").innerHTML = "<span class='ok'>üîì Nivel avanzado desbloqueado. Contin√∫a.</span>";
  render();
}

function darPremio(){
  ganar();
}

function terminarJuego(mensaje){
  if (intervalo) clearInterval(intervalo);

  localStorage.setItem(STORAGE_KEY, "1");
  document.getElementById("decision").style.display = "none";
  document.getElementById("quiz").innerHTML = "";
  document.getElementById("timer").innerText = "‚Äî";
  document.getElementById("msg").innerHTML = `<span class='lock'>üö´ ${mensaje}</span>`;

  // deshabilitar cualquier bot√≥n visible
  document.querySelectorAll("button").forEach(b => b.disabled = true);
}

function ganar(){
  if (intervalo) clearInterval(intervalo);

  document.getElementById("decision").style.display = "none";
  document.getElementById("quiz").innerHTML = "";
  document.getElementById("timer").innerText = "‚Äî";

  document.getElementById("reward").style.display = "block";
  document.getElementById("downloadBtn").style.display = "block";
  document.getElementById("msg").innerHTML =
    "<span class='ok'>üèÜ Investigaci√≥n completada. Evidencia desbloqueada.</span>";
}

/* ================= START ================= */
render();

/* ================= RESET (solo para ti, manual)
   En consola del navegador:
   localStorage.removeItem('criminopatia_bloqueado')
*/
</script>

</body>
</html>

